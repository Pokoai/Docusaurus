---
position: 3
---

```c

// 头文件
#include <reg52.h>

// 类型重定义
typedef unsigned char u8;
typedef unsigned int u16;

// 管脚定义
#define LED P0  
#define KEY P1  // 8个独立按键

sbit key1 = P2^0;  // 一个按键


// ms 延时函数
static void delay_ms(u16 n)
{
    n *= 23;
    while (n--);
}


// 8个独立按键扫描函数
u8 duli_key_scan()
{
    u8 number;
    u8 t;

    // 按键是否按下检测
    if ( KEY != 0xFF ) {  // 按下
        delay_ms(5);  // 延时消抖
        if ( KEY != 0xFF ) {  // 消抖完再次检测
            // 此时可以进行按键扫描了
            switch (KEY) {
                case 0xFE: number = 1; break;
                case 0xFD: number = 2; break;
                case 0xFB: number = 3; break;
                case 0xF7: number = 4; break;
                case 0xEF: number = 5; break;
                case 0xDF: number = 6; break;
                case 0xBF: number = 7; break;
                case 0x7F: number = 8; break;
            }
        }
        // 松手检测
        while ( KEY != 0xFF );
    }

    return number;
}

// 单个按键检测函数
void duli_key_scan2()
{
    if ( key1 == 0 ) {
        delay_ms(5);
        if (key1 == 0 ) {
            // 可以进行操作
            ......
        }
        while ( !key1 );
    }
}


void main()
{   
    u8 key_num = 0;

    while (1) {
        key_num = duli_key_scan();
        
        if ( key_num == 1 ) {
            ......
        }
        if ( key_num == 2) {
            ......
        }
    }
}

```