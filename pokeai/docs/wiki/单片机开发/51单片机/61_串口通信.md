---  
position: 9
---

```c

// 头文件
#include <reg52.h>

// 类型重定义
typedef unsigned char u8;
typedef unsigned int u16;

// 全局变量
bit busy;


// 定时器1初始化
void timer1_init()
{
    TMOD = 0x20;  // 8位自动重装

    TH1 = 0xFD;  // 波特率 9600
    TL1 = 0xFD;

    EA = 1;
    TR1 = 1;
}

// 串口初始化
void uart_init()
{
    // 1.设置工作方式1
    SM0 = 0;
    SM1 = 1;

    // 2.不倍频
    PCON &= 0x7F;

    // 3.开中断
    ES = 1;
}

// 串口中断服务函数
void uart_isr() interrupt 4
{
    // 接收到数据
    if (RI) {
        RI = 0;
        P0 = SBUF;    // 接收到的数据送到 P0
    }

    // 发送数据 
    if (TI) {  // 发送完 TI 被硬件置1
        TI = 0;
        busy = 0;  // 清除发送忙信号
    }
}

// 发送一字节数据
void send_byte(u8 dat)
{
    while (busy);  // 直到上一帧数据发送完毕

    SBUF = dat;  // 开始发送
    busy = 1;

}

// 发送字符串
void send_string(char *str)
{
    while (*s) {
        send_byte(*str++);
    }
}


void main()
{
    timer1_init();
    uart_init();

    send_string("Hello, PC");
    while (1);
        
}

```
