---
position: 6
---

```c

// 头文件
#include <reg52.h>

// 类型重定义
typedef unsigned char u8;
typedef unsigned int u16;

// 管脚定义
#define DIG P0

sbit LSA = P1^0;  // 138译码器
sbit LSB = P1^1;
sbit LSC = P1^2;

// 数码管段选表 code：将数列写到 ROM 中，而非空间极其有限的 RAM 里
u8 code SmgDuanTable = {
    0x3f,0x06,0x5b,0x4f,
    0x66,0x6d,0x7d,0x07,
	0x7f,0x6f,0x77,0x7c,
    0x39,0x5e,0x79,0x71,
    
    0x76, 0x79, 0x38, 0x3f,  // hello
};


// ms 延时函数
static void delay_ms(u16 n)
{
    n *= 23;
    while (n--);
}

// 数码管显示函数 显示一个四位数
void dig_display(u16 n)
{
    u8 i;
    u8 disp[4];
    // 先拆分四位数，千百十个
    disp[0] = num / 1000;
    disp[1] = num % 1000 / 100;
    disp[2] = num % 1000 % 100 / 10;
    disp[3] = num % 1000 % 100 % 10;

    for ( i = 0; i < 4; i++ ) {
        switch (i) {
            case 0: LSC = 0; LSB = 0; LSA = 0; break;
            case 1: LSC = 0; LSB = 0; LSA = 1; break;
            case 2: LSC = 0; LSB = 1; LSA = 0; break;
            case 3: LSC = 0; LSB = 1; LSA = 1; break; 
        }
        DIG = SmgDuanTable[disp[i]];
        delay_ms(100);
        DIG = 0x00;  // 消影
    }

    // 或者用以下方式：
    u8 ge = number % 10;
    u8 shi = number / 10 % 10;
    u8 bai = number / 100;

    // 显示百位
    LSC = 0, LSB = 0, LSA = 0; 
    P0 = SmgDuanTable[bai];
    delay_ms(5);
    P0 = 0x00;
    
    // 显示十位
    LSA = 1;  // LSC = 0, LSB = 0, LSA = 1;
    P0 = SmgDuanTable[shi];
    delay_ms(5);
    P0 = 0x00;

    // 显示个位
    LSB = 1, LSA = 0;  // LSC = 0, LSB = 1, LSA = 0;
    P0 = SmgDuanTable[ge];
    delay_ms(5);
    P0 = 0x00;
}

// 数码管显示 HELLO
void smg_display_str()
{
    LSC = 0, LSB = 0, LSA = 0; 
    P0 = SmgDuanTable[16];
    delay_ms(5);
    P0 = 0x00;
    
    LSA = 1;  // LSC = 0, LSB = 0, LSA = 1;
    P0 = SmgDuanTable[17];
    delay_ms(5);
    P0 = 0x00;

    LSB = 1, LSA = 0;  // LSC = 0, LSB = 1, LSA = 0;
    P0 = SmgDuanTable[18];
    delay_ms(5);
    P0 = 0x00;

    LSA = 1;  // LSC = 0, LSB = 1, LSA = 1;
    P0 = SmgDuanTable[18];
    delay_ms(5);
    P0 = 0x00;

    LSC = 1, LSB = 0, LSA = 0;  // LSC = 1, LSB = 0, LSA = 0;
    P0 = SmgDuanTable[19];
    delay_ms(5);
    P0 = 0x00;
}

void main()
{   
    u16 dat;
    dat = 1234;

    while (1) {
        dig_display(dat);
    }
}

```